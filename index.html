<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>Evolução das Maquinas</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4CAF50;
            --danger-color: #d9534f;
            --info-color: #5bc0de;
            --text-color: #E0E0E0;
            --text-shadow: 2px 2px 4px black;
            --border-color: rgba(255, 255, 255, 0.2);
            --font-main: 'Roboto Mono', monospace;
            --font-title: 'Press Start 2P', cursive;
        }
        body { margin: 0; overflow: hidden; font-family: var(--font-main); color: var(--text-color); background-color: #000; }
        canvas#game-canvas { display: block; }
        
        /* --- Overlays & Menus --- */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; text-shadow: var(--text-shadow);
            backdrop-filter: blur(5px);
            visibility: hidden; z-index: 10; opacity: 0;
            transition: visibility 0s 0.3s, opacity 0.3s ease-in-out;
        }
        .overlay.visible { visibility: visible; opacity: 1; transition-delay: 0s; }
        .overlay h1 { font-family: var(--font-title); font-size: 3em; margin-bottom: 20px; color: var(--primary-color); text-shadow: 0 0 15px var(--primary-color); }
        .overlay h2 { font-family: var(--font-title); font-size: 1.5em; margin-bottom: 40px; }
        
        .menu-container { display: flex; flex-direction: column; gap: 15px; }

        .overlay button {
            font-family: var(--font-main); font-weight: 700;
            padding: 15px 30px; font-size: 1.2em; cursor: pointer;
            background-color: transparent; color: var(--text-color);
            border: 2px solid var(--primary-color); border-radius: 5px; margin: 5px;
            width: 350px; text-align: center;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
            transition: all 0.2s ease-out;
        }
        .overlay button:hover { background-color: var(--primary-color); color: #000; transform: scale(1.05); box-shadow: 0 0 20px rgba(76, 175, 80, 0.8); }
        .overlay button:active { transform: scale(1.02); }
        .overlay button.danger { border-color: var(--danger-color); box-shadow: 0 0 8px rgba(217, 83, 79, 0.5); }
        .overlay button.danger:hover { background-color: var(--danger-color); box-shadow: 0 0 20px rgba(217, 83, 79, 0.8); }

        #level-up-screen { flex-direction: row; justify-content: space-evenly; align-items: center; }
        #upgrade-options button { width: 450px; text-align: left; }
        #upgrade-options button b { color: #ffffa1; }
        #upgrade-options button small { display: block; font-size: 0.8em; margin-top: 5px; opacity: 0.8; }
        #upgrade-preview-container { width: 400px; height: 400px; background-color: rgba(0,0,0,0.5); border: 2px solid var(--primary-color); border-radius: 10px; box-shadow: 0 0 20px rgba(76, 175, 80, 0.5); }
        #upgrade-preview-canvas { width: 100%; height: 100%; border-radius: 8px; }

        /* --- HUD --- */
        #hud { position: absolute; top: 10px; left: 10px; background-color: rgba(0,0,0,0.6); padding: 10px; border-radius: 5px; width: 320px; text-shadow: 1px 1px 2px black; border: 1px solid var(--border-color); font-size: 0.9em; }
        #hud p { margin: 0 0 5px 0; }
        .bar { width: 100%; height: 20px; background-color: #555; border-radius: 3px; overflow: hidden; border: 1px solid #777; }
        #health-bar-fill { height: 100%; background-color: var(--danger-color); transition: width 0.2s, background-color 0.5s; }
        #health-bar-fill.low-health { background-color: #ff0000; animation: pulse-red 1s infinite; }
        #xp-bar-fill { height: 100%; background-color: var(--info-color); transition: width 0.2s; }
        #dash-status { font-weight: bold; color: var(--info-color); transition: color 0.2s; }
        #dash-status.recharging { color: var(--danger-color); }
        #upgrade-icons { margin-top: 10px; display: flex; flex-wrap: wrap; gap: 5px; }
        .icon { width: 24px; height: 24px; background-color: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); border-radius: 4px; display: flex; justify-content: center; align-items: center; font-size: 14px; font-weight: bold; position: relative; cursor: help; }
        .icon-level { position: absolute; bottom: -2px; right: -2px; background-color: #000; color: #fff; border-radius: 50%; font-size: 9px; width: 12px; height: 12px; line-height: 12px; text-align: center;}
        #boss-hud { visibility: hidden; position: absolute; top: 20px; left: 50%; transform: translateX(-50%); width: 50%; text-align: center; text-shadow: var(--text-shadow); }
        #boss-hud h2 { font-family: var(--font-title); font-size: 1.2em; }
        #boss-health-bar-fill { height: 25px; background-color: #e330c7; transition: width 0.2s; border: 2px solid white; box-shadow: 0 0 10px #e330c7; }
        
        /* --- In-Game Effects --- */
        #damage-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
        .damage-text { position: absolute; font-weight: bold; text-shadow: 2px 2px 3px #000; user-select: none; animation: damage-pop-and-float 1s cubic-bezier(0.23, 1, 0.32, 1) forwards; font-family: var(--font-title); font-size: 14px; }
        
        #wave-announcer { position: absolute; top: 25%; left: 50%; transform: translateX(-50%); font-family: var(--font-title); font-size: 4em; color: white; text-shadow: 0 0 20px #fff; pointer-events: none; opacity: 0; transition: all 0.5s ease-out; }
        #wave-announcer.show { opacity: 1; top: 30%; }
        
        /* --- NOVO: Estilos para a introdução --- */
        #intro-announcer {
            position: absolute;
            top: 35%;
            left: 50%;
            transform: translateX(-50%);
            pointer-events: none;
            opacity: 0;
            transition: all 0.5s ease-out;
            text-align: center;
        }
        #intro-announcer.show {
            opacity: 1;
            top: 40%;
        }
        #intro-announcer p {
            font-family: var(--font-title);
            text-shadow: 0 0 20px #fff;
            margin: 0;
        }
        #intro-line-1 {
            font-size: 2em;
            color: white;
        }
        #intro-line-2 {
            font-size: 3.5em;
            color: var(--primary-color);
            text-shadow: 0 0 20px var(--primary-color);
        }
        /* --- Fim dos estilos de introdução --- */

        #vignette { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5; box-shadow: inset 0 0 200px rgba(255, 0, 0, 0); transition: box-shadow 0.5s ease-out; }
        #vignette.active { box-shadow: inset 0 0 200px rgba(255, 0, 0, 0.6); }

        #menu-canvas { position: absolute; top: 0; left: 0; z-index: -1; }
        .options-container { background: rgba(0,0,0,0.5); padding: 20px 40px; border-radius: 10px; border: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 20px; width: 400px; }
        .option-item { display: flex; justify-content: space-between; align-items: center; font-size: 1.1em; }
        .option-item label { margin-right: 20px; }
        input[type="range"] { -webkit-appearance: none; appearance: none; width: 200px; height: 8px; background: #555; outline: none; border-radius: 5px; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: var(--primary-color); cursor: pointer; border-radius: 50%; }
        .how-to-play-content { background: rgba(0,0,0,0.5); padding: 30px; border-radius: 10px; border: 1px solid var(--border-color); text-align: left; max-width: 500px; line-height: 1.8; }
        .how-to-play-content b { color: var(--primary-color); }
        .tooltip { visibility: hidden; background-color: black; color: #fff; text-align: center; border-radius: 6px; padding: 5px 10px; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -60px; opacity: 0; transition: opacity 0.3s; width: 120px; font-size: 0.8em;}
        .icon:hover .tooltip { visibility: visible; opacity: 1; }
        
        /* --- NOVO: Estilo do crédito no menu --- */
        .credit-text {
            position: absolute;
            bottom: 15px;
            right: 20px;
            font-family: var(--font-main);
            font-size: 0.9em;
            color: var(--text-color);
            opacity: 0.6;
            pointer-events: none;
        }

        #debug-menu .debug-container { background: rgba(10, 25, 36, 0.9); padding: 20px 40px; border-radius: 10px; border: 1px solid var(--info-color); display: flex; flex-direction: column; gap: 20px; width: 600px; max-height: 80vh; overflow-y: auto; }
        #debug-menu h2, #debug-menu h3 { font-family: var(--font-title); color: var(--info-color); text-shadow: 0 0 10px var(--info-color); margin: 10px 0; text-align: left; }
        #debug-menu .debug-section { border-top: 1px solid var(--border-color); padding-top: 15px; text-align: left; }
        #debug-menu .debug-section button, #debug-menu .debug-section input { font-family: var(--font-main); padding: 8px 12px; margin: 5px; background: #333; border: 1px solid #777; color: var(--text-color); border-radius: 4px; }
        #debug-menu .debug-section button { cursor: pointer; transition: background 0.2s; }
        #debug-menu .debug-section button:hover { background: #555; }
        #debug-menu .debug-section button.active { background: var(--primary-color); color: #000; font-weight: bold; }
        #debug-menu #debug-upgrades-list { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        #debug-menu .debug-upgrade-item { display: flex; align-items: center; background: rgba(0,0,0,0.2); padding: 5px; border-radius: 3px; }
        #debug-menu .debug-upgrade-item label { flex-grow: 1; cursor: pointer; }
        #debug-menu .debug-upgrade-item input[type="checkbox"] { width: 20px; height: 20px; margin-left: 10px; cursor: pointer; }
        #debug-menu #debug-close-button { width: auto; align-self: center; }

        #qte-announcer { position: absolute; bottom: 20%; left: 50%; transform: translateX(-50%); font-family: var(--font-title); font-size: 3em; color: white; text-shadow: 0 0 20px #fff; pointer-events: none; opacity: 0; transition: all 0.5s ease-out; }
        #qte-announcer.show { opacity: 1; bottom: 25%; }
        #qte-announcer.success { color: #4CAF50; text-shadow: 0 0 20px #4CAF50; }
        #qte-announcer.fail { color: #d9534f; text-shadow: 0 0 20px #d9534f; }
        
        @keyframes damage-pop-and-float { 0% { transform: translateY(0) scale(0.5); opacity: 0; } 20% { transform: translateY(-20px) scale(1.1); opacity: 1; } 100% { transform: translateY(-80px) scale(0.8); opacity: 0; } }
        @keyframes pulse-red { 50% { filter: brightness(1.5); } }
    </style>
</head>
<body>
    <canvas id="menu-canvas"></canvas>
    <div id="damage-container"></div>
    <div id="wave-announcer"></div>
    <div id="vignette"></div>
    <div id="qte-announcer"></div>
    
    <!-- NOVO: Elemento para a introdução -->
    <div id="intro-announcer">
        <p id="intro-line-1"></p>
        <p id="intro-line-2"></p>
    </div>

    <div id="cutscene-overlay">
        <div class="letterbox top"></div>
        <div id="subtitle-text"></div>
        <div class="letterbox bottom"></div>
    </div>

    <div id="hud" style="visibility: hidden;">
        <p>Nível: <span id="level-text">1</span> | Onda: <span id="wave-text">0</span></p>
        <p>Vida</p> <div class="bar"><div id="health-bar-fill"></div></div>
        <p>XP</p> <div class="bar"><div id="xp-bar-fill"></div></div>
        <p>Dash: <span id="dash-status">PRONTO</span></p>
        <div style="display: flex; align-items: center;">
             <p style="margin-right: 5px;">Combo:</p>
             <span id="combo-text" style="color: #ffa500; font-weight: bold;">0x</span>
        </div>
        <div id="upgrade-icons"></div>
    </div>

    <div id="boss-hud"> <h2 id="boss-name-text">BOSS</h2> <div class="bar"><div id="boss-health-bar-fill"></div></div> </div>
    
    <!-- === MENUS === -->
    <div id="main-menu" class="overlay">
        <h1>Evolução das Maquinas</h1>
        <div class="menu-container">
            <button id="start-button">Iniciar Jogo</button>
            <button id="how-to-play-button">Como Jogar</button>
            <button id="options-button">Opções</button>
        </div>
        <!-- NOVO: Crédito no canto -->
        <div class="credit-text">Feito por gustarlz</div>
    </div>

    <div id="pause-menu" class="overlay">
        <h1>Pausado</h1>
        <div class="menu-container">
            <button id="resume-button">Retornar</button>
            <button id="options-button-pause">Opções</button>
            <button id="restart-button-pause" class="danger">Reiniciar</button>
        </div>
    </div>

    <div id="how-to-play-screen" class="overlay">
        <h1>Como Jogar</h1>
        <div class="how-to-play-content">
            <p><b>WASD:</b> Mover</p>
            <p><b>Mouse:</b> Mirar</p>
            <p><b>Clique Esquerdo:</b> Atirar</p>
            <p><b>Barra de Espaço:</b> Dash</p>
            <p><b>P / ESC:</b> Pausar Jogo</p>
            <p><b>' (Apóstrofo):</b> Menu de Debug</p>
            <hr>
            <p>Sobreviva a ondas de inimigos, colete XP para subir de nível e escolha evoluções para se tornar mais forte!</p>
            <p><b>Dica Pro:</b> Use o Dash através de projéteis inimigos para apará-los e ganhar um bônus de dano!</p>
        </div>
        <button id="back-button-htp" style="margin-top: 20px;">Voltar</button>
    </div>

    <div id="options-screen" class="overlay">
        <h1>Opções</h1>
        <div class="options-container">
            <div class="option-item">
                <label for="music-volume">Música</label>
                <input type="range" id="music-volume" min="0" max="1" step="0.05" value="0.3">
            </div>
            <div class="option-item">
                <label for="sfx-volume">Efeitos</label>
                <input type="range" id="sfx-volume" min="0" max="1" step="0.05" value="0.5">
            </div>
        </div>
        <button id="back-button-options" style="margin-top: 20px;">Voltar</button>
    </div>

    <div id="level-up-screen" class="overlay">
        <div id="upgrade-preview-container"> <canvas id="upgrade-preview-canvas"></canvas> </div>
        <div>
            <h1>Subiu de Nível!</h1> <h2>Escolha sua evolução:</h2>
            <div id="upgrade-options"></div>
        </div>
    </div>

    <div id="game-over-screen" class="overlay">
        <h1>Fim de Jogo</h1>
        <h2>Você sobreviveu até a Onda <span id="final-wave-text">0</span>.</h2>
        <button id="restart-button">Reiniciar</button>
    </div>

    <canvas id="game-canvas"></canvas>
    
<div id="debug-menu" class="overlay">
    <div class="debug-container">
    <h2>Debug Menu</h2>
    <div class="debug-section">
        <label for="debug-wave-input">Set Wave:</label>
        <input type="number" id="debug-wave-input" value="1" min="1">
        <button id="debug-set-wave-button">Go</button>
    </div>
    <div class="debug-section">
        <button id="debug-heal-button">Heal Player</button>
        <button id="debug-xp-button">Gain Level</button>
        <button id="debug-god-mode-button">Toggle God Mode</button>
        <button id="debug-kill-enemies-button">Kill All Enemies</button>
    </div>
    <div class="debug-section">
        <h4>Spawn Specific Boss</h4>
        <select id="debug-boss-selector"></select>
        <button id="debug-spawn-boss-button">Spawn Boss</button>
    </div>
    <div class="debug-section">
        <h3>Upgrades</h3>
        <div id="debug-upgrades-list">
        </div>
    </div>
    <button id="debug-close-button" style="margin-top: 20px;">Close (')</button>
</div>
    
    <script type="importmap"> { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/" } } </script>
    <script type="module" src="game.js"></script>
</body>
</html>