:root {
    --primary-color: #4CAF50;
    --danger-color: #d9534f;
    --info-color: #5bc0de;
    --text-color: #E0E0E0;
    --text-shadow: 2px 2px 4px black;
    --border-color: rgba(255, 255, 255, 0.2);
    
    /* We use the custom font, but add a very common font as a backup */
    --font-main: 'Roboto Mono', Consolas, 'Courier New', monospace;
    --font-title: 'Press Start 2P', 'Arial Black', Impact, sans-serif;
}
        body { margin: 0; overflow: hidden; font-family: var(--font-main); color: var(--text-color); background-color: #000; }
        canvas#game-canvas { display: block; }
        
        /* --- Overlays & Menus --- */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; text-shadow: var(--text-shadow);
            backdrop-filter: blur(5px);
            visibility: hidden; z-index: 10; opacity: 0;
            transition: visibility 0s 0.3s, opacity 0.3s ease-in-out;
        }
        .overlay.visible { visibility: visible; opacity: 1; transition-delay: 0s; }
        .overlay h1 { font-family: var(--font-title); font-size: 3em; margin-bottom: 20px; color: var(--primary-color); text-shadow: 0 0 15px var(--primary-color); }
        .overlay h2 { font-family: var(--font-title); font-size: 1.5em; margin-bottom: 40px; }
        
        .menu-container { display: flex; flex-direction: column; gap: 15px; }

        .overlay button {
            font-family: var(--font-main); font-weight: 700;
            padding: 15px 30px; font-size: 1.2em; cursor: pointer;
            background-color: transparent; color: var(--text-color);
            border: 2px solid var(--primary-color); border-radius: 5px; margin: 5px;
            width: 350px; text-align: center;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
            transition: all 0.2s ease-out;
        }
        .overlay button:hover { background-color: var(--primary-color); color: #000; transform: scale(1.05); box-shadow: 0 0 20px rgba(76, 175, 80, 0.8); }
        .overlay button:active { transform: scale(1.02); }
        .overlay button.danger { border-color: var(--danger-color); box-shadow: 0 0 8px rgba(217, 83, 79, 0.5); }
        .overlay button.danger:hover { background-color: var(--danger-color); box-shadow: 0 0 20px rgba(217, 83, 79, 0.8); }

        #level-up-screen { flex-direction: row; justify-content: space-evenly; align-items: center; }
        #upgrade-options button { width: 450px; text-align: left; }
        #upgrade-options button b { color: #ffffa1; }
        #upgrade-options button small { display: block; font-size: 0.8em; margin-top: 5px; opacity: 0.8; }
        #upgrade-preview-container { width: 400px; height: 400px; background-color: rgba(0,0,0,0.5); border: 2px solid var(--primary-color); border-radius: 10px; box-shadow: 0 0 20px rgba(76, 175, 80, 0.5); }
        #upgrade-preview-canvas { width: 100%; height: 100%; border-radius: 8px; }

        /* --- HUD --- */
        #hud { position: absolute; top: 10px; left: 10px; background-color: rgba(0,0,0,0.6); padding: 10px; border-radius: 5px; width: 320px; text-shadow: 1px 1px 2px black; border: 1px solid var(--border-color); font-size: 0.9em; }
        #hud p { margin: 0 0 5px 0; }
        .bar { width: 100%; height: 20px; background-color: #555; border-radius: 3px; overflow: hidden; border: 1px solid #777; }
        #health-bar-fill { height: 100%; background-color: var(--danger-color); transition: width 0.2s, background-color 0.5s; }
        #health-bar-fill.low-health { background-color: #ff0000; animation: pulse-red 1s infinite; }
        #xp-bar-fill { height: 100%; background-color: var(--info-color); transition: width 0.2s; }
        #dash-status { font-weight: bold; color: var(--info-color); transition: color 0.2s; }
        #dash-status.recharging { color: var(--danger-color); }
        #upgrade-icons { margin-top: 10px; display: flex; flex-wrap: wrap; gap: 5px; }
        .icon { width: 24px; height: 24px; background-color: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); border-radius: 4px; display: flex; justify-content: center; align-items: center; font-size: 14px; font-weight: bold; position: relative; cursor: help; }
        .icon-level { position: absolute; bottom: -2px; right: -2px; background-color: #000; color: #fff; border-radius: 50%; font-size: 9px; width: 12px; height: 12px; line-height: 12px; text-align: center;}
        #boss-hud { visibility: hidden; position: absolute; top: 20px; left: 50%; transform: translateX(-50%); width: 50%; text-align: center; text-shadow: var(--text-shadow); }
        #boss-hud h2 { font-family: var(--font-title); font-size: 1.2em; }
        #boss-health-bar-fill { height: 25px; background-color: #e330c7; transition: width 0.2s; border: 2px solid white; box-shadow: 0 0 10px #e330c7; }
        
        /* --- In-Game Effects --- */
        #damage-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
        .damage-text { position: absolute; font-weight: bold; text-shadow: 2px 2px 3px #000; user-select: none; animation: damage-pop-and-float 1s cubic-bezier(0.23, 1, 0.32, 1) forwards; font-family: var(--font-title); font-size: 14px; }
        #wave-announcer { position: absolute; top: 25%; left: 50%; transform: translateX(-50%); font-family: var(--font-title); font-size: 4em; color: white; text-shadow: 0 0 20px #fff; pointer-events: none; opacity: 0; transition: all 0.5s ease-out; }
        #wave-announcer.show { opacity: 1; top: 30%; }
        #vignette { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5; box-shadow: inset 0 0 200px rgba(255, 0, 0, 0); transition: box-shadow 0.5s ease-out; }
        #vignette.active { box-shadow: inset 0 0 200px rgba(255, 0, 0, 0.6); }

        /* --- New Menu Elements --- */
        #menu-canvas { position: absolute; top: 0; left: 0; z-index: -1; }
        .options-container { background: rgba(0,0,0,0.5); padding: 20px 40px; border-radius: 10px; border: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 20px; width: 400px; }
        .option-item { display: flex; justify-content: space-between; align-items: center; font-size: 1.1em; }
        .option-item label { margin-right: 20px; }
        input[type="range"] { -webkit-appearance: none; appearance: none; width: 200px; height: 8px; background: #555; outline: none; border-radius: 5px; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: var(--primary-color); cursor: pointer; border-radius: 50%; }
        .how-to-play-content { background: rgba(0,0,0,0.5); padding: 30px; border-radius: 10px; border: 1px solid var(--border-color); text-align: left; max-width: 500px; line-height: 1.8; }
        .how-to-play-content b { color: var(--primary-color); }
        .tooltip { visibility: hidden; background-color: black; color: #fff; text-align: center; border-radius: 6px; padding: 5px 10px; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -60px; opacity: 0; transition: opacity 0.3s; width: 120px; font-size: 0.8em;}
        .icon:hover .tooltip { visibility: visible; opacity: 1; }

        @keyframes damage-pop-and-float { 0% { transform: translateY(0) scale(0.5); opacity: 0; } 20% { transform: translateY(-20px) scale(1.1); opacity: 1; } 100% { transform: translateY(-80px) scale(0.8); opacity: 0; } }
        @keyframes pulse-red { 50% { filter: brightness(1.5); } }